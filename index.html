<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LAN Chatbot â€” Riddhi Sahu</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0f0f1a;--surface:#1a1a2e;--surface2:#222240;--primary:#4285F4;--green:#34A853;--red:#EA4335;--yellow:#FBBC04;--text:#e8eaed;--text2:#9aa0a6;--border:rgba(255,255,255,0.08)}
body{font-family:'Poppins',sans-serif;background:var(--bg);color:var(--text);height:100vh;overflow:hidden}

/* Login Screen */
.login-screen{position:fixed;inset:0;background:var(--bg);display:flex;align-items:center;justify-content:center;z-index:100;transition:opacity 0.5s,transform 0.5s}
.login-screen.hidden{opacity:0;pointer-events:none;transform:scale(1.05)}
.login-box{text-align:center;background:var(--surface);padding:48px;border-radius:24px;border:1px solid var(--border);width:420px;box-shadow:0 20px 60px rgba(0,0,0,0.5)}
.login-box h1{font-size:28px;font-weight:700;margin-bottom:4px}
.login-box h1 span{color:var(--primary)}
.login-box p{color:var(--text2);font-size:13px;margin-bottom:32px}
.login-dots{display:flex;justify-content:center;gap:6px;margin-bottom:24px}
.login-dots span{width:10px;height:10px;border-radius:50%}
.login-input{width:100%;padding:14px 20px;background:var(--surface2);border:1.5px solid var(--border);border-radius:14px;color:var(--text);font-size:15px;font-family:'Poppins',sans-serif;outline:none;transition:border 0.3s;margin-bottom:16px}
.login-input:focus{border-color:var(--primary)}
.login-btn{width:100%;padding:14px;background:var(--primary);color:#fff;border:none;border-radius:14px;font-size:15px;font-weight:600;cursor:pointer;font-family:'Poppins',sans-serif;transition:all 0.3s}
.login-btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(66,133,244,0.3)}
.login-error{color:var(--red);font-size:13px;margin-top:12px;display:none}

/* Chat Container */
.chat-container{display:grid;grid-template-columns:260px 1fr;height:100vh;opacity:0;transition:opacity 0.5s}
.chat-container.visible{opacity:1}

/* Sidebar */
.sidebar{background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
.sidebar-header{padding:20px;border-bottom:1px solid var(--border)}
.sidebar-header h2{font-size:18px;font-weight:600;display:flex;align-items:center;gap:8px}
.sidebar-header h2 .material-icons-outlined{color:var(--primary);font-size:22px}
.online-count{font-size:12px;color:var(--text2);margin-top:4px}
.user-list{flex:1;overflow-y:auto;padding:12px}
.user-item{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:12px;margin-bottom:4px;cursor:pointer;transition:background 0.2s}
.user-item:hover{background:var(--surface2)}
.user-avatar{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:14px;color:#fff}
.user-item .status-dot{width:8px;height:8px;background:var(--green);border-radius:50%;margin-left:auto}
.sidebar-footer{padding:16px;border-top:1px solid var(--border);font-size:12px;color:var(--text2);text-align:center}

/* Main Chat */
.main-chat{display:flex;flex-direction:column;height:100vh}
.chat-header{padding:16px 24px;border-bottom:1px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:space-between}
.chat-header h3{font-size:16px;font-weight:600;display:flex;align-items:center;gap:8px}
.chat-header .material-icons-outlined{color:var(--primary)}
.typing-indicator{font-size:12px;color:var(--text2);font-style:italic;min-height:16px}

/* Messages Area */
.messages{flex:1;overflow-y:auto;padding:20px 24px;display:flex;flex-direction:column;gap:8px}
.messages::-webkit-scrollbar{width:6px}
.messages::-webkit-scrollbar-thumb{background:var(--surface2);border-radius:3px}

.msg{display:flex;gap:10px;max-width:70%;animation:msgIn 0.3s ease}
.msg.self{align-self:flex-end;flex-direction:row-reverse}
.msg-avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;color:#fff;flex-shrink:0;margin-top:4px}
.msg-bubble{padding:10px 16px;border-radius:16px;background:var(--surface2);border:1px solid var(--border);position:relative}
.msg.self .msg-bubble{background:var(--primary);border:none;color:#fff}
.msg-user{font-size:11px;font-weight:600;color:var(--primary);margin-bottom:2px}
.msg.self .msg-user{color:rgba(255,255,255,0.7)}
.msg-text{font-size:14px;line-height:1.5;word-break:break-word}
.msg-time{font-size:10px;color:var(--text2);margin-top:4px}
.msg.self .msg-time{color:rgba(255,255,255,0.6)}

.system-msg{text-align:center;font-size:12px;color:var(--text2);padding:8px;background:var(--surface);border-radius:20px;align-self:center;max-width:80%}
.notification-msg{text-align:center;font-size:12px;padding:6px 16px;border-radius:20px;align-self:center}
.notification-msg.join{color:var(--green);background:rgba(52,168,83,0.1)}
.notification-msg.leave{color:var(--red);background:rgba(234,67,53,0.1)}
.private-msg .msg-bubble{background:rgba(156,39,176,0.15);border:1px solid rgba(156,39,176,0.3)}
.private-label{font-size:10px;color:#9c27b0;font-weight:600;margin-bottom:2px}

/* Input Area */
.input-area{padding:16px 24px;border-top:1px solid var(--border);background:var(--surface);display:flex;gap:12px;align-items:center}
.msg-input{flex:1;padding:12px 20px;background:var(--surface2);border:1.5px solid var(--border);border-radius:24px;color:var(--text);font-size:14px;font-family:'Poppins',sans-serif;outline:none;transition:border 0.3s}
.msg-input:focus{border-color:var(--primary)}
.send-btn{width:44px;height:44px;border-radius:50%;background:var(--primary);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s;color:#fff}
.send-btn:hover{transform:scale(1.1);box-shadow:0 4px 16px rgba(66,133,244,0.4)}
.send-btn .material-icons-outlined{font-size:20px}

@keyframes msgIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* Responsive */
@media(max-width:768px){
    .chat-container{grid-template-columns:1fr}
    .sidebar{display:none}
}
</style>
</head>
<body>

<!-- Login Screen -->
<div class="login-screen" id="loginScreen">
  <div class="login-box">
    <div class="login-dots">
      <span style="background:#4285F4"></span>
      <span style="background:#EA4335"></span>
      <span style="background:#FBBC04"></span>
      <span style="background:#34A853"></span>
    </div>
    <h1>LAN <span>Chatbot</span></h1>
    <p>Real-time PC-to-PC chat over Local Area Network</p>
    <input type="text" class="login-input" id="usernameInput" placeholder="Choose a username..." maxlength="20" autofocus>
    <button class="login-btn" id="joinBtn" onclick="joinChat()">
      <span class="material-icons-outlined" style="vertical-align:middle;font-size:18px;margin-right:4px">login</span>
      Join Chat
    </button>
    <div class="login-error" id="loginError"></div>
  </div>
</div>

<!-- Chat UI -->
<div class="chat-container" id="chatContainer">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h2><span class="material-icons-outlined">forum</span> LAN Chatbot</h2>
      <div class="online-count" id="onlineCount">0 online</div>
    </div>
    <div class="user-list" id="userList"></div>
    <div class="sidebar-footer">Built by Riddhi Sahu<br>SRMIST | 2026</div>
  </div>

  <!-- Main Chat Area -->
  <div class="main-chat">
    <div class="chat-header">
      <h3><span class="material-icons-outlined">chat_bubble</span> General Chat</h3>
      <div class="typing-indicator" id="typingIndicator"></div>
    </div>
    <div class="messages" id="messages"></div>
    <div class="input-area">
      <input type="text" class="msg-input" id="msgInput" placeholder="Type a message... (/help for commands)" maxlength="500">
      <button class="send-btn" onclick="sendMessage()">
        <span class="material-icons-outlined">send</span>
      </button>
    </div>
  </div>
</div>

<script>
const socket = io();
let username = '';
const colors = ['#4285F4','#EA4335','#FBBC04','#34A853','#9C27B0','#FF6D00','#00BCD4','#E91E63'];
const userColorMap = {};
let typingTimeout;

function getColor(name) {
    if (!userColorMap[name]) {
        let hash = 0;
        for (let i = 0; i < name.length; i++) hash = name.charCodeAt(i) + ((hash << 5) - hash);
        userColorMap[name] = colors[Math.abs(hash) % colors.length];
    }
    return userColorMap[name];
}

function joinChat() {
    username = document.getElementById('usernameInput').value.trim();
    if (!username) { showError('Please enter a username'); return; }
    socket.emit('join', { username });
}

document.getElementById('usernameInput').addEventListener('keypress', e => { if (e.key === 'Enter') joinChat(); });
document.getElementById('msgInput').addEventListener('keypress', e => {
    if (e.key === 'Enter') sendMessage();
    else socket.emit('typing', {});
});

function showError(msg) {
    const el = document.getElementById('loginError');
    el.textContent = msg; el.style.display = 'block';
    setTimeout(() => el.style.display = 'none', 3000);
}

socket.on('system', data => {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('chatContainer').classList.add('visible');
    addSystemMsg(data.message);
    updateUsers(data.online_users, data.user_count);
    document.getElementById('msgInput').focus();
});

socket.on('error', data => showError(data.message));

socket.on('history', data => {
    data.messages.forEach(msg => addChatMsg(msg.username, msg.message, msg.timestamp, false));
});

socket.on('new_message', data => addChatMsg(data.username, data.message, data.timestamp, true));

socket.on('user_joined', data => {
    addNotification(`${data.username} joined the chat`, 'join');
    updateUsers(data.online_users, data.user_count);
});

socket.on('user_left', data => {
    addNotification(`${data.username} left the chat`, 'leave');
    updateUsers(data.online_users, data.user_count);
});

socket.on('private_msg', data => {
    addPrivateMsg(data.from, data.message, data.timestamp, false);
});

socket.on('private_sent', data => {
    addPrivateMsg(data.to, data.message, data.timestamp, true);
});

socket.on('user_typing', data => {
    document.getElementById('typingIndicator').textContent = `${data.username} is typing...`;
    clearTimeout(typingTimeout);
    typingTimeout = setTimeout(() => document.getElementById('typingIndicator').textContent = '', 2000);
});

function sendMessage() {
    const input = document.getElementById('msgInput');
    const text = input.value.trim();
    if (!text) return;
    input.value = '';

    if (text.startsWith('/pm ') && text.indexOf('@') === 4) {
        const rest = text.substring(5);
        const idx = rest.indexOf(' ');
        if (idx > 0) {
            socket.emit('private_message', { target: rest.substring(0, idx), message: rest.substring(idx + 1) });
        }
    } else {
        socket.emit('message', { message: text });
    }
}

function addChatMsg(user, text, time, scroll) {
    const div = document.createElement('div');
    const isSelf = user === username;
    const color = getColor(user);
    div.className = `msg ${isSelf ? 'self' : ''}`;
    div.innerHTML = `
        <div class="msg-avatar" style="background:${color}">${user[0].toUpperCase()}</div>
        <div class="msg-bubble">
            <div class="msg-user">${isSelf ? 'You' : user}</div>
            <div class="msg-text">${escapeHtml(text)}</div>
            <div class="msg-time">${time}</div>
        </div>`;
    document.getElementById('messages').appendChild(div);
    if (scroll) scrollBottom();
}

function addSystemMsg(text) {
    const div = document.createElement('div');
    div.className = 'system-msg';
    div.textContent = text;
    document.getElementById('messages').appendChild(div);
    scrollBottom();
}

function addNotification(text, type) {
    const div = document.createElement('div');
    div.className = `notification-msg ${type}`;
    div.textContent = text;
    document.getElementById('messages').appendChild(div);
    scrollBottom();
}

function addPrivateMsg(otherUser, text, time, isSent) {
    const div = document.createElement('div');
    div.className = `msg private-msg ${isSent ? 'self' : ''}`;
    div.innerHTML = `
        <div class="msg-avatar" style="background:#9C27B0">${otherUser[0].toUpperCase()}</div>
        <div class="msg-bubble">
            <div class="private-label">Private ${isSent ? 'to ' + otherUser : 'from ' + otherUser}</div>
            <div class="msg-text">${escapeHtml(text)}</div>
            <div class="msg-time">${time}</div>
        </div>`;
    document.getElementById('messages').appendChild(div);
    scrollBottom();
}

function updateUsers(users, count) {
    document.getElementById('onlineCount').textContent = `${count} online`;
    const list = document.getElementById('userList');
    list.innerHTML = '';
    users.forEach(u => {
        const color = getColor(u);
        const item = document.createElement('div');
        item.className = 'user-item';
        item.innerHTML = `<div class="user-avatar" style="background:${color}">${u[0].toUpperCase()}</div><span>${u}${u===username?' (You)':''}</span><div class="status-dot"></div>`;
        list.appendChild(item);
    });
}

function scrollBottom() {
    const el = document.getElementById('messages');
    setTimeout(() => el.scrollTop = el.scrollHeight, 50);
}

function escapeHtml(t) {
    const d = document.createElement('div'); d.textContent = t; return d.innerHTML;
}
</script>
</body>
</html>
